<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Simple PWA</title>

    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#0d6efd" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <h1>ðŸš€ My Simple PWA</h1>
    <p>This works offline and can be installed. with button</p>

    <button id="showTokenBtn">ðŸ’¡ Show FCM Token</button>
    <p id="tokenDisplay" style="word-break: break-all"></p>

    <button id="installBtn" style="display: none">ðŸ“² Install App</button>

    <script>
      // Service Worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/firebase-messaging-sw.js");
      }

      let deferredPrompt;
      const installBtn = document.getElementById("installBtn");

      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = "inline-block";
      });

      installBtn.addEventListener("click", async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        installBtn.style.display = "none";
      });

      window.addEventListener("appinstalled", () => {
        installBtn.style.display = "none";
      });
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getMessaging,
        getToken,
        onMessage,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID",
      };

      const app = initializeApp(firebaseConfig);
      const messaging = getMessaging(app);

      let fcmToken = null;

      // Ask permission and get token
      Notification.requestPermission().then((permission) => {
        if (permission === "granted") {
          getToken(messaging, { vapidKey: "YOUR_PUBLIC_VAPID_KEY" })
            .then((token) => {
              fcmToken = token;
              console.log("âœ… FCM Token:", token);
            })
            .catch((err) => console.error("âŒ Error getting FCM token:", err));
        } else {
          console.log("âŒ Notification permission denied");
        }
      });

      // Show token button
      const showTokenBtn = document.getElementById("showTokenBtn");
      const tokenDisplay = document.getElementById("tokenDisplay");

      showTokenBtn.addEventListener("click", () => {
        if (fcmToken) {
          tokenDisplay.textContent = fcmToken;
        } else {
          tokenDisplay.textContent =
            "Token not available yet. Make sure notifications are allowed.";
        }
      });

      // Foreground messages
      onMessage(messaging, (payload) => {
        console.log("ðŸ“© Message received:", payload);
      });
    </script>
  </body>
</html>
